# aviasales
Тестовое задание для aviasales
# Описание

Реализовать сервис подсказок локации.
У наших друзей aviasales есть замечательный сервис подсказок, который помогает пользователям выбрать город зная всего пару букв. Но так как у нас много виджетов, и они уже работают совсем с другим форматом, мы хотим завернуть этот сервис через себя, что бы приводить его в нужный виджетам формат. Вот пример запроса к этому сервису ```https://places.aviasales.ru/v2/places.json?term=Москва&locale=ru&types%5B%5D=city&types%5B%5D=airport```

А вот формат ответа с которым могут работать наши виджеты:

```[{"slug":"MOW","subtitle":"Russia","title":"Moscow"},{"slug":"DME","subtitle":"Moscow","title":"Moscow Domodedovo Airport"}, ... ]```

# Что мы хотим от тебя получить:
1. Ссылку на репозиторий

2. Инструкцию как его запустить и проверить

# Немного дополнительной информации:
Ребята из aviasales конечно молодцы, что сделали такой крутой сервис, но иногда он у них не работает или слишком долго отвечает, для нас это неприемлемо, максимальное время ответа, которое может ждать виджет – 3с. Хорошо, что эти данные нечасто обновляются, и мы сможем кэшировать результаты у себя.
Мы любим docker и docker-compose.
Мы любим хорошее логирование, оно помогает находить проблемы.

# Запуск проекта
Для запуска приложения запустить команду
 
```docker-compose up --build```

В корне проекта лежит [файл](aviasales.postman_collection.json) для Postman

Если Postman нет, то вот curl

```curl -X GET 'http://localhost:7000/api/v1/places?term=%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B0&locale=ru&types[]=city,airport' \```

Запрос необходимо делать в ```/api/v1/places``` все параметры, которые будут переданы просто проксируются. Если упадёт сервис aviasales, то будет так же получена ошибка, если нет данных в кеше по этому запросу.

## Configuration

файл конфигурации находится в корне проекта ```config/config.yaml```. 

Путь в докере /go/config/config.yaml

Это поведение можно переопределить, добавив --conf после имени приложения, данный путь должен указывать на файл конфигурации. 

```aviasales --conf=new/path/to/config.yaml web```

```aviasales --conf=new/path/to/config.yaml worker```

Так же новый файл можно прокинуть через volumes или как configMap в kubernetes. 

| Parameter             | Description                                                 | Default                       |
|-----------------------|-------------------------------------------------------------|-------------------------------|
| Debug                 | Переменная для включения дебаг режиме                       | `True`                        |
| Redis.Addr            | Хост редиса                                                 | `localhost:6379`              |
| Redis.Password        | Пароль для редиса                                           | ""                            |
| Redis.DB              | Какую базу данных редиса необходимо использовать            | `0`                           |
| Redis.Expiration      | Время кеширования                                           | 60 сек                        |
| Aviasales.Url         | DNS имя API, куда необходимо слать запросы                  | `https://places.aviasales.ru` |
| Server.Port           | Порт, на котором будет запущен API сервер                   | `7000`                        |
| Worker.Count          | Количество воркеров                                         | `2`                           |
| Worker.UpdateInterval | Как часто необходимо запускать воркеры                      | 30 сек                        |
| Worker.Expiration     | Время на которое кеширует воркер                            | 60 сек                        |
| Worker.LogToFile      | Отправлять весь лог в файл /var/logs/{Worker.LogFilename}   | false                         |
| Worker.LogFilename    | Имя файла, куда необходимо вести логирование                | `worker.log`                  |